# Use the official Node.js image as the base image
FROM node:18

# File Author / Maintainer
LABEL maintainer="Neelesh Ranjan Jha"

# Set the working directory inside the container
WORKDIR /app

# Copy package.json, yarn.lock (if available), and the .tgz file for the xlsx dependency
COPY package.json yarn.lock* ./
ADD https://cdn.sheetjs.com/xlsx-0.20.0/xlsx-0.20.0.tgz xlsx-0.20.0.tgz

# Install dependencies, including the local .tgz file
RUN yarn install

# Copy the rest of the application code to the container
COPY . .

ARG NEXT_PUBLIC_ENVIRONEMENT=DEVELOPMENT
ENV NEXT_PUBLIC_ENVIRONEMENT=${NEXT_PUBLIC_ENVIRONEMENT}

ARG NEXT_PUBLIC_API_BASE_URL
ENV NEXT_PUBLIC_API_BASE_URL=${NEXT_PUBLIC_API_BASE_URL}

ARG NEXT_PUBLIC_CUSTOMER_API_BASE_URL
ENV NEXT_PUBLIC_CUSTOMER_API_BASE_URL=${NEXT_PUBLIC_CUSTOMER_API_BASE_URL}

ARG NEXT_PUBLIC_PRIMARY_COLOR
ENV NEXT_PUBLIC_PRIMARY_COLOR=${NEXT_PUBLIC_PRIMARY_COLOR}

ARG NEXT_PUBLIC_SECONDARY_COLOR
ENV NEXT_PUBLIC_SECONDARY_COLOR=${NEXT_PUBLIC_SECONDARY_COLOR}

ARG NEXT_PUBLIC_BACKGROUND_COLOR
ENV NEXT_PUBLIC_BACKGROUND_COLOR=${NEXT_PUBLIC_BACKGROUND_COLOR}

ARG NEXT_PUBLIC_CARD_COLOR
ENV NEXT_PUBLIC_CARD_COLOR=${NEXT_PUBLIC_CARD_COLOR}

ARG NEXT_PUBLIC_PAGE_NAME
ENV NEXT_PUBLIC_PAGE_NAME=${NEXT_PUBLIC_PAGE_NAME}

ARG NEXT_PUBLIC_LOGIN_BG
ENV NEXT_PUBLIC_LOGIN_BG=${NEXT_PUBLIC_LOGIN_BG}

ARG NEXT_PUBLIC_LOGIN_LOGO
ENV NEXT_PUBLIC_LOGIN_LOGO=${NEXT_PUBLIC_LOGIN_LOGO}

ARG NEXT_PUBLIC_SPACE_URL
ENV NEXT_PUBLIC_SPACE_URL=${NEXT_PUBLIC_SPACE_URL}

ARG NEXT_PUBLIC_SPACE_CDN_URL
ENV NEXT_PUBLIC_SPACE_CDN_URL=${NEXT_PUBLIC_SPACE_CDN_URL}

ARG NEXT_PUBLIC_ENDPOINT
ENV NEXT_PUBLIC_ENDPOINT=${NEXT_PUBLIC_ENDPOINT}

ARG NEXT_PUBLIC_CDN_ENDPOINT
ENV NEXT_PUBLIC_CDN_ENDPOINT=${NEXT_PUBLIC_CDN_ENDPOINT}

ARG NEXT_PUBLIC_SENTRY_DSN
ENV NEXT_PUBLIC_SENTRY_DSN=${NEXT_PUBLIC_SENTRY_DSN}

ARG NEXT_PUBLIC_SENTRY_AUTH_TOKEN
ENV NEXT_PUBLIC_SENTRY_AUTH_TOKEN=${NEXT_PUBLIC_SENTRY_AUTH_TOKEN}

ARG NEXT_PUBLIC_SENTRY_ORG
ENV NEXT_PUBLIC_SENTRY_ORG=${NEXT_PUBLIC_SENTRY_ORG}

ARG NEXT_PUBLIC_SENTRY_PROJECT_NAME
ENV NEXT_PUBLIC_SENTRY_PROJECT_NAME=${NEXT_PUBLIC_SENTRY_PROJECT_NAME}

ARG NEXT_PUBLIC_SENTRY_AUTH_TOKEN
ENV NEXT_PUBLIC_SENTRY_AUTH_TOKEN=${NEXT_PUBLIC_SENTRY_AUTH_TOKEN}

# Build the Next.js application
RUN yarn build

# Expose the port the app will run on
EXPOSE 3001

# Start the app
CMD ["yarn", "start"]